<!DOCTYPE html><html><head> <meta charset="utf-8"> <title>Note App</title><style type="text/css">*{margin:0;padding:0}html,body{height:100%}.hidden{visibility:hidden}#List{display:inline-block;padding:0}#List li{cursor:pointer;padding:5px 20px;outline:1px solid gray;list-style-type:none}#List .open{font-weight:bold;background:red}#Detail .dates{float:right}</style></head><body><div id="Content"><div id="Toolbar"> <input type="button" data-name="new" value="New"/> <input type="button" data-name="delete" value="Delete" disabled="true"/> </div><ul id="List"></ul><div id="Detail" class="hidden"><div class="dates"><p data-name="created"></p><p data-name="modified"></p></div><h2 data-name="title" contentEditable="true"></h2> <hr> <p data-name="body" contentEditable="true"></p></div></div><script>(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a){return a(o,!0)}if(i){return i(o,!0)}var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o+=1){s(r[o])}return s})({1:[function(require,module,exports){function copyObjectGraph(obj){if(typeof WeakMap!=='function'){throw new ReferenceError('copyObjectGraph requires WeakMap')}var _pool=new WeakMap();return cpObj(obj);function cpObj(obj){var cp;if(typeof obj!=='object'){return obj}if(obj===null){return null}if(_pool.has(obj)){return _pool.get(obj);}if(Array.isArray(obj)){cp=obj.slice()}else{cp=Object.assign({},obj)}_pool.set(obj,cp);return cpProps(cp)}function cpProps(cp){for(var prop in cp){cp[prop]=cpObj(cp[prop])}return cp}}module.exports=copyObjectGraph},{}],10:[function(require,module,exports){'use strict';function StorageManager(type){if(type!=='localStorage'&&type!=='sessionStorage'){throw new ReferenceError(`StorageManager does not support storage type ${ type }`)}const myStore=window[type];return{clear(){myStore.clear()},get(key){var item=myStore.getItem(key);if(item!==null){return item}return false},getAll(){var key='';var map={};var item=null;for(var i=0;i<myStore.length;i+=1){key=myStore.key(i);if(~key.indexOf('_')){continue}item=myStore.getItem(key);map[key]=item}return map},length(){return myStore.length},remove(key){var item=myStore.getItem(key);if(item===null){return false}myStore.removeItem(key);return true},set(key,obj){try{var data;if(typeof obj!=='string'){data=JSON.stringify(obj)}else{data=obj}myStore.setItem(key,data);return true}catch(e){console.error(e);return false}}}}module.exports=StorageManager},{}],2:[function(require,module,exports){'use strict';const copyObjectGraph=require('copy-object-graph');const myName='EventRouter';function EventRouter(shouldLogCalls){const events=Object.create(null);var public_interface={add(type,key,callback){return _add(type,key,callback,events)},emit(type,key,data){return _emit(type,key,data,events)},getEvents(){return copyObjectGraph(events)},purge(type){return _purge(type,events)},remove(type,key,callback){return _remove(type,key,callback,events)}};if(shouldLogCalls){for(let method_name in public_interface){public_interface[method_name]=closure(method_name,public_interface[method_name])}console.info(myName,'is logging calls')}function closure(method_name,method){return function(...args){console.info(myName,method_name,args[0],args[1]);return method.apply(null,args)}}return Object.freeze(public_interface)}module.exports=EventRouter;function _purge(t,o){delete o[t]}function _emit(t,k,d,o){var ot=o[t];if(ot===undefined){console.warn(myName,'event type',t,k,'was just fired but there are no registered callbacks');return false}var otk=ot[k];if(otk===undefined){console.warn(myName,'event type',t,k,'was just fired but there are no registered callbacks');return false}for(let cb of otk){cb(d)}return true}function _add(t,k,cb,o){var ot=o[t];if(ot===undefined){ot=o[t]={}}var otk=ot[k];if(otk===undefined){otk=ot[k]=[]}if(otk.includes(cb)){console.warn(myName,'event type',t,k,'already has this callback function');return false}else{otk.push(cb)}return true}function _remove(t,k,cb,o){var ot=o[t];if(ot===undefined){console.warn(myName,'cannot find type',t);return false}var otk=ot[k];if(otk===undefined){console.warn(myName,'cannot find key',k,'in type',t);return false}if(!otk.includes(cb)){console.warn(myName,'cannot find this callback function under key',k,'in type',t);return false}otk.splice(otk.indexOf(cb),1);if(!otk.length){delete ot[k];if(!Object.keys(ot).length){delete o[t]}}return true}},{"copy-object-graph":1}],3:[function(require,module,exports){'use strict';const EventRouter=require('event-router');module.exports=function ViewModel(shouldLogEvents){const M={};var R;if(shouldLogEvents){R=EventRouter(true)}else{R=EventRouter(false)}function ViewModel(){return Object.keys(M)}ViewModel.create=function(key,extend_members){var model=M[key];if(model!==undefined){return false}model=M[key]=Object.create(null);model.instance=modelInstance(key);model.listeners=new WeakMap();Object.freeze(Object.assign(model.instance,extend_members));return true};ViewModel.run=function(key,funcToRun,...args){var model=M[key];if(model===undefined){return false}funcToRun.apply(model.instance,args);return true};ViewModel.exists=function(key){if(M[key]===undefined){return false}return true};ViewModel.destroy=function(key){if(M[key]===undefined){return false}R.purge(key);delete M[key];return true};ViewModel.add=function(key,methods){var results={};var model=M[key];if(model===undefined){return false}for(let name in methods){let method=methods[name];let boundMethod;if(typeof method!=='function'){results[name]=false;continue}if(model.listeners.has(method)){boundMethod=model.listeners.get(method)}else{boundMethod=method.bind(model.instance);model.listeners.set(method,boundMethod)}results[name]=R.add(key,name,boundMethod)}return results},ViewModel.remove=function(key,methods){var results={};var model=M[key];if(model===undefined){return false}for(let name in methods){let method=methods[name];if(typeof method!=='function'){results[name]=false;continue}if(model.listeners.has(method)){results[name]=R.remove(key,name,model.listeners.get(method))}}return results};function modelInstance(_key){return{emit(name,data){R.emit(_key,name,data)},name:_key}}return ViewModel}},{"event-router":2}],4:[function(require,module,exports){'use strict';var app=require('view-model')(true);module.exports=app;let toolbar_name='toolbar_';let detail_name='detail_';let model_name=require('./models/Note')();require('./views/Toolbar')(toolbar_name,model_name);require('./views/Detail')(detail_name,model_name);require('./views/List')(toolbar_name,detail_name,model_name)},{"./models/Note":6,"./views/Detail":7,"./views/List":8,"./views/Toolbar":9,"view-model":3}],5:[function(require,module,exports){module.exports=function(){var d=new Date().getTime();if(window.performance&&typeof window.performance.now==="function"){d+=window.performance.now();}var uuid='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=='x'?r:(r&0x3|0x8)).toString(16)});return uuid}},{}],6:[function(require,module,exports){'use strict';var app=require('../app');module.exports=function(){const myName='Note';const STORE=require('storage-manager')('localStorage');const generateUUID=require('../lib/generateUUID');const NOTES=STORE.getAll();for(let key in NOTES){NOTES[key]=JSON.parse(NOTES[key])}const blank={body:'Enter some body text here',created:null,modified:null,title:'New '+myName};app.create(myName,{delete(key){delete NOTES[key];STORE.remove(key);this.emit('delete',key)},get(key,prop){var nk=NOTES[key];if(nk===undefined){return console.warn(this.name,'key',key,'does not exist')}var nkp=nk[prop];if(nkp===undefined){return console.warn(this.name,'property',prop,'for key',key,'does not exist')}if(typeof nkp==='object'&&nkp!==null){return console.warn(this.name,'property',prop,'for key',key,'is an object. Only primitives can be accessed.')}return nkp},getKeys(){return Object.keys(NOTES)},new(){var key=generateUUID();blank.created=blank.modified=Date().toString();STORE.set(key,blank);NOTES[key]=Object.assign({},blank);this.emit('new',key)},update(key,obj){var changed=false;var nk=NOTES[key];if(nk===undefined){return console.warn(this.name,'key',key,'does not exist')}for(let prop in obj){let nkp=nk[prop];if(nkp===undefined){console.warn(this.name,'property',prop,'for key',key,'does not exist');continue}if(nkp!==obj[prop]){nk[prop]=obj[prop];this.emit('update_'+prop,key);changed=true}}if(changed){NOTES[key].modified=Date().toString();this.emit('update_modified',key);STORE.set(key,NOTES[key])}}});return myName}},{"../app":4,"../lib/generateUUID":5,"storage-manager":10}],7:[function(require,module,exports){'use strict';var app=require('../app');module.exports=function(myName,myModel){const myView=document.getElementById('Detail');const myData=Object.create(null);for(let i=0,els=myView.querySelectorAll('[data-name]');i<els.length;i+=1){let e=els[i];myData[e.dataset.name]=e}var myKey=null;function input(e){e.stopPropagation();app.run(myModel,_input,e.target)}function _input(target){this.update(myKey,{[target.dataset.name]:target.textContent})}myView.addEventListener('input',input,true);app.add(myModel,{[myName+'clear'](){if(myView.classList.contains('hidden')){return}myView.classList.add('hidden');myKey=null},[myName+'set'](key){myKey=key;for(let name in myData){myData[name].textContent=this.get(myKey,name)}if(myView.classList.contains('hidden')){myView.classList.remove('hidden')}},update_modified(key){if(myKey!==key){return}myData['modified'].textContent=this.get(myKey,'modified')}})}},{"../app":4}],8:[function(require,module,exports){'use strict';var app=require('../app');module.exports=function(myToolbar,myDetail,myModel){const myView=document.getElementById('List');const myKeys=new WeakMap();var open_el=null;var auto_open=false;function click(e){e.stopPropagation();app.run(myModel,_click,e.target)}function _click(target){if(!open(target)){return}this.emit(myToolbar+'enableButton','delete');this.emit(myDetail+'set',myKeys.get(open_el))}function open(target){if(open_el){if(open_el===target){return false;}open_el.classList.remove('open')}open_el=target;open_el.classList.add('open');return true;}myView.addEventListener('click',click,true);app.add(myModel,{[myToolbar+'new'](){auto_open=true;this.new()},[myToolbar+'delete'](){this.delete(myKeys.get(open_el))},delete(key){open_el.remove();open_el=null;this.emit(myToolbar+'disableButton','delete');this.emit(myDetail+'clear')},new(key){var title=this.get(key,'title');var li=document.createElement('li');li.textContent=title;myKeys.set(li,key);myView.insertBefore(li,myView.childNodes[0]);if(auto_open){auto_open=false;_click.call(this,li)}},update_title(key){open_el.innerText=this.get(key,'title')}});app.run(myModel,function(){this.getKeys().forEach(key=>this.emit('new',key))})}},{"../app":4}],9:[function(require,module,exports){'use strict';var app=require('../app');module.exports=function(myName,myModel){const myView=document.getElementById('Toolbar');const myData=Object.create(null);{let els=myView.querySelectorAll('[data-name]');for(let i=0;i<els.length;i+=1){myData[els[i].dataset.name]=els[i]}}function click(e){e.stopPropagation();app.run(myModel,_click,e.target)}function _click(target){var name=target.dataset.name;if(name!=='delete'){return this.emit(myName+name)}if(window.confirm(`Are you sure you want to delete this ${ myModel } ?`)){this.emit(myName+name)}}myView.addEventListener('click',click,true);app.add(myModel,{[myName+'enableButton'](btn_name){var btn=myData[btn_name];if(btn!==undefined){btn.disabled=false}else{console.warn('Cannot find button by name',btn_name)}},[myName+'disableButton'](btn_name){var btn=myData[btn_name];if(btn!==undefined){btn.disabled=true}else{console.warn('Cannot find button by name',btn_name)}}})}},{"../app":4}]},{},[4]);
</script></body></html>
